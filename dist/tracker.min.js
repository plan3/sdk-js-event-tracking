!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.Activity=e():t.Activity=e()}(this,function(){return function(t){function e(i){if(r[i])return r[i].exports;var n=r[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";function i(t){if(!t.clientId)throw new Error("clientId is required");if(!t.pageId)throw new Error("pageId is required");if(this.vars=o,this.url=t.url?t.url:this.vars.envVars.dataCollectorUrl,this.transport=t.transport?t.transport:d,this.clientId=t.clientId,this.pageId=t.pageId,this.pageType=t.pageType||"Page",this.provider=t.provider||{},this.queue=[],this.events=new s(this),this.user=new c(this),t.userId)this.userId=t.userId;else{var e=this;n("Fetching userId"),this.user.getUserId(function(t,r){if(t)throw new Error("Could not fetch id");e.userId=r,e.waitingToTransmitQueue===!0&&e.sendQueue()})}}var n=r(1)("spt:pulse"),o={};try{o=r(2)}catch(a){o=r(3)}var s=r(4),u=r(5),c=r(6),d=r(7);i.prototype.addToQueue=function(t){this.queue.push(t)},i.prototype.sendQueue=function(t){if(t||(t=function(){}),!this.queue.length)return t();if("undefined"==typeof this.userId)return this.waitingToTransmitQueue=!0,t();n("Sending queue");for(var e=this.queue.slice(0),r=0;r<e.length;r++)this.addUserId(e[r]);this.queue=[];var i=this;this.transport(this.url,e,function(r){r?(n("Failed to send queue"),i.queue=i.queue.concat(e),t(r)):t()})},i.prototype.addUserId=function(t){void 0!==this.userId&&(t.actor["@id"]=this.userId)},i.prototype.send=function(t,e){if(e||(e=function(){}),"undefined"==typeof this.userId)return this.addToQueue(t),this.waitingToTransmitQueue=!0,e();n("Sending object");var r=this;t.actor["@id"]=this.userId,this.transport(this.url,[t],function(i){i?(n("Failed to send object"),r.addToQueue(t),e(i)):e()})},i.prototype.createActor=function(){var t={};return t["@type"]="Person",t["spt:userAgent"]=navigator.userAgent,t["spt:screenSize"]=window.screen.width+"x"+window.screen.height,t["spt:viewportSize"]=u.getViewportDimensions(),t["spt:acceptLanguage"]=u.getDeviceLanguage(),t},i.prototype.createProvider=function(){var t={};t["@type"]="Organization",t["@id"]="urn:spid.no:"+this.clientId,t.url=document.URL;for(var e in this.provider)this.provider.hasOwnProperty(e)&&(t[e]=this.provider[e]);return t},i.prototype.createScaffold=function(){var t={},e={spt:"http://spid.no","spt:sdkType":"JS","spt:sdkVersion":"0.1.0"};return t["@context"]=["http://www.w3.org/ns/activitystreams",e],t["@id"]=u.getUuidV4(),t.published=u.getTimestamp(),t.actor=this.createActor(),t.provider=this.createProvider(),t},t.exports=i},function(t){"use strict";t.exports=function(){return function(){}}},function(t){t.exports.envVars={dataCollectorUrl:"http://pulse.spid.se/api/v1/track",userServiceUrl:"http://pulse.spid.se/api/v1/identity"}},function(t){t.exports.envVars={dataCollectorUrl:"http://127.0.0.1:8002/api/v1/track",userServiceUrl:"http://127.0.0.1:8003/api/v1/identity"}},function(t,e,r){"use strict";function i(t){if(!t)throw new Error("activity required");this.activity=t,this.pageId=t.pageId,this.pageType=t.pageType}var n=r(8);i.prototype.trackPageLoad=function(t,e){var r=this.activity.createScaffold();return r["@type"]=e||"Read",r.object=this.addPageStandards(),r.object.displayName=t||document.title,new n(this.activity,r,["object"])},i.prototype.trackForm=function(t,e,r){var i=this.activity.createScaffold();return i["@type"]=r||"Post",i.object=this.addPageStandards(),i.result={"@type":e,"@id":this.pageId+":form:"+t},new n(this.activity,i,["object","result"])},i.prototype.trackComment=function(t,e){return this.trackForm(t,"Note",e)},i.prototype.trackPoll=function(t,e){return this.trackForm(t,"Question",e)},i.prototype.trackClick=function(t,e,r,i,o){var a=this.activity.createScaffold();return a["@type"]=o||"Accept",a.object={"@id":this.pageId+":element:"+t,"@type":"Link",displayName:e},a.target={"@id":i,"@type":r},new n(this.activity,a,["object","target"])},i.prototype.trackSocial=function(t,e,r){var i=this.activity.createScaffold();return i["@type"]=r||"Like",i.object=this.addPageStandards(),i.origin={"@id":this.pageId+":element:"+t,"@type":"Link"},i.target={"@id":"urn:"+e,"@type":"Service"},new n(this.activity,i,["object","origin","target"])},i.prototype.trackMediaState=function(t,e,r){var i=this.activity.createScaffold();return i["@type"]=r||"Watch",i.object={"@type":e,"@id":t},i.origin=this.addPageStandards(),new n(this.activity,i,["object","origin"])},i.prototype.trackScroll=function(t,e){var r=this.activity.createScaffold();return r["@type"]=e||"Arrive",r.object=this.addPageStandards(),r.result={"@type":"Place","@id":this.pageId+":scroll:"+t,location:t},new n(this.activity,r,["object","result"])},i.prototype.trackExit=function(t,e,r){var i=this.activity.createScaffold();return i["@type"]=r||"Leave",i.object=this.addPageStandards(),i.target={"@type":e,"@id":t},new n(this.activity,i,["object","target"])},i.prototype.trackEngagementTime=function(t,e){var r=this.activity.createScaffold();return r["@type"]=e||"View",r.object=this.addPageStandards(),r.duration=t,new n(this.activity,r,["object"])},i.prototype.addPageStandards=function(){var t={};return t["@type"]=this.activity.pageType,t["@id"]=this.activity.pageId,t.url=document.URL,t.displayName=document.title,t},t.exports=i},function(t){"use strict";t.exports.retry=function(t,e,r){if(!t||"number"!=typeof t)throw new Error("times required");if(!e||"function"!=typeof e)throw new Error("task required");if(!r||"function"!=typeof r)throw new Error("callback required");var i=1,n=function(){arguments[0]&&i>=t?r.apply(null,arguments):arguments[0]?(i+=1,e(n)):r.apply(null,arguments)};e(n)},t.exports.getViewportDimensions=function(){var t,e;return"undefined"!=typeof window.innerWidth?(t=window.innerWidth,e=window.innerHeight):"undefined"!=typeof document.documentElement.clientWidth&&0!==document.documentElement.clientWidth?(t=document.documentElement.clientWidth,e=document.documentElement.clientHeight):(t=document.getElementsByTagName("body")[0].clientWidth,e=document.getElementsByTagName("body")[0].clientHeight),t+"x"+e},t.exports.getDeviceLanguage=function(){var t;return navigator.userLanguage?t=navigator.userLanguage:navigator.language&&(t=navigator.language),t},t.exports.getTimestamp=function(){var t=new Date,e=-t.getTimezoneOffset(),r=e>=0?"+":"-",i=function(t){var e=Math.abs(Math.floor(t));return(10>e?"0":"")+e},n=t.getFullYear()+"-"+i(t.getMonth()+1)+"-"+i(t.getDate());return n=n+"T"+i(t.getHours())+":"+i(t.getMinutes()),n=n+":"+i(t.getSeconds()),n=n+r+i(e/60)+":"+i(e%60)},t.exports.getUuidV4=function(){for(var t="",e=0;36>e;e++){var r=null;r=14===e?4:19===e?Math.floor(4*Math.random()+8).toString(16):8===e||13===e||18===e||23===e?"-":Math.floor(16*Math.random()).toString(16),t+=r}return t}},function(t,e,r){"use strict";function i(t){this.userId=void 0,this.key="DataTrackerUser",this.idServiceUrl="http://127.0.0.1:8003/api/v1/identify",this.activity=t,this.opts=t.opts,this.transport=this.activity.transport?this.activity.transport:n}var n=r(7);i.prototype.getUserId=function(t){if(void 0!==this.userId)return t(null,this.userId);var e=this.getUserIdFromCookie(),r=this;this.getUserIdFromService(e,function(e,i){return e?t(e):(r.userId=i,r.setUserIdInCookie(),void t(null,i))})},i.prototype.getUserIdFromCookie=function(){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(this.key).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||!1},i.prototype.getUserIdFromService=function(t,e){t+=1,this.transport("http://127.0.0.1:8003/api/v1/identify",{foo:"bar"},function(t,r){if(t)return e(t);var i=JSON.parse(r.response);e(null,i.data.sessionId)})},i.prototype.setUserIdInCookie=function(){document.cookie=this.key+"="+this.userId},t.exports=i},function(t,e,r){"use strict";function i(){if(XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.6.0")}catch(t){try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(t){throw new Error("This browser does not support AJAX")}}}function n(t,e,r){if(!r)throw new Error("callback required");return t?e&&"object"==typeof e?void o.retry(5,function(r){var n=i();n.onreadystatechange=function(){4===this.readyState&&(200===this.status?r(null,n):r("Failed with status "+this.status))},n.open("POST",t),n.setRequestHeader("Content-Type","application/json; charset=utf-8"),n.setRequestHeader("X-Requested-With","XMLHttpRequest");try{var o=JSON.stringify(e);n.send(o)}catch(a){r(a.name+": "+a.message)}},r):r("data required"):r("url required")}var o=r(5);t.exports=n},function(t){"use strict";function e(t,e,r){if(!t)throw new Error("activity required");if(!e)throw new Error("data required");this.activity=t,this.data=e,this.objectOrder=r||[]}e.prototype.queue=function(){this.activity.addToQueue(this.data)},e.prototype.send=function(t){this.activity.send(this.data,t)},e.prototype.addProperty=function(t,e,r){var i=this.getObjectKey(t);return this.data[i][e]=r,this},e.prototype.addCustomData=function(t,e){var r=this.getObjectKey(t);return this.data[r]["spt:custom"]=e,this},e.prototype.getObjectKey=function(t){if("primary"===t)return this.objectOrder[0];if("secondary"===t)return this.objectOrder[1];if("tertiary"===t)return this.objectOrder[2];throw new Error("Object reference not valid")},t.exports=e}])});