!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.Activity=e():t.Activity=e()}(this,function(){return function(t){function e(r){if(i[r])return i[r].exports;var o=i[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function r(t){if(!t.clientId)throw new Error("clientId is required");if(!t.pageId)throw new Error("pageId is required");this.vars=n,this.url=t.url?t.url:this.vars.envVars.dataCollectorUrl,this.transport=t.transport?t.transport:u,this.allowTracking=t.respectDoNotTrack===!0&&1===navigator.doNotTrack?!1:!0,this.pageViewId=d.getUuidV4(),this.clientId=t.clientId,this.pageId=t.pageId,this.pageType=t.pageType||"Page",this.provider=t.provider||{},this.userIdDomain=t.userIdDomain||"spid.no",this.utils=d,this.queue=[],this.events=new a(this),this.user=new c(this),t.visitorId&&(this.visitorId=t.visitorId),t.userId&&(this.userId=t.userId);var e=this;o("Fetching Ids"),this.user.getUserId(function(t,i){if(t)throw new Error("Could not fetch id");e.visitorId||(e.visitorId=i.visitorId),e.userId||(e.userId=i.userId),e.envId=i.envId,e.sessionId=i.sessionId,e.waitingToTransmitQueue===!0&&(e.sendQueue(),e.waitingToTransmitQueue=!1)})}var o=i(1)("spt:pulse"),n={};try{n=i(7)}catch(s){n=i(2)}var a=i(3),d=i(4),c=i(5),u=i(6);r.prototype.addToQueue=function(t){this.queue.push(t)},r.prototype.sendQueue=function(t){if(t||(t=function(){}),!this.queue.length)return t();if(!this.allowTracking)return t();if("undefined"==typeof this.visitorId)return this.waitingToTransmitQueue=!0,t();o("Sending queue");for(var e=this.queue.slice(0),i=0;i<e.length;i++)this.addUserId(e[i]);this.queue=[];var r=this;this.transport(this.url,e,function(i){i?(o("Failed to send queue"),r.queue=r.queue.concat(e),t(i)):t()})},r.prototype.addUserId=function(t){void 0!==this.visitorId&&(t.actor["@id"]="urn:spid.no:person:"+this.visitorId,t.actor["spt:environmentId"]="urn:spid.no:environment:"+this.envId,t.actor["spt:sessionId"]="urn:spid.no:session:"+this.sessionId,t.actor["spt:userId"]="urn:"+this.userIdDomain+":user:"+this.userId)},r.prototype.send=function(t,e){if(e||(e=function(){}),!this.allowTracking)return e();if("undefined"==typeof this.visitorId)return this.addToQueue(t),this.waitingToTransmitQueue=!0,e();o("Sending object");var i=this;this.addUserId(t),this.transport(this.url,[t],function(r){r?(o("Failed to send object"),i.addToQueue(t),e(r)):e()})},r.prototype.createActor=function(){var t={};return t["@type"]="Person",t["spt:userAgent"]=navigator.userAgent,t["spt:screenSize"]=window.screen.width+"x"+window.screen.height,t["spt:viewportSize"]=d.getViewportDimensions(),t["spt:acceptLanguage"]=d.getDeviceLanguage(),t},r.prototype.createReducedActor=function(){var t={};return t["@type"]="Person",t},r.prototype.createProvider=function(){var t={};t["@type"]="Organization",t["@id"]="urn:spid.no:"+this.clientId,t.url=document.URL;for(var e in this.provider)this.provider.hasOwnProperty(e)&&(t[e]=this.provider[e]);return t},r.prototype.createScaffold=function(t){var e={},i={spt:"http://spid.no","spt:sdkType":"JS","spt:sdkVersion":"0.1.0"};return e["@context"]=["http://www.w3.org/ns/activitystreams",i],e["@id"]=d.getUuidV4(),e["spt:pageViewId"]=this.pageViewId,e.published=d.getTimestamp(),e.actor=t?this.createActor():this.createReducedActor(),e.provider=this.createProvider(),e},r.prototype.getPageViewId=function(){return this.pageViewId},r.prototype.getSessionId=function(){return this.sessionId},r.prototype.getVisitorId=function(){return this.visitorId},r.prototype.refreshUserIds=function(t){this.user.idObj.visitorId=void 0,this.user.idObj.userId=t||void 0,this.visitorId=void 0,this.userId=t||void 0,this.user.setUserIdInCookie(!1);var e=this;this.user.getUserId(function(t,i){if(console.log(i),t)throw new Error("Could not fetch id");e.visitorId||(e.visitorId=i.visitorId),e.userId||(e.userId=i.userId),e.envId=i.envId,e.sessionId=i.sessionId,e.waitingToTransmitQueue===!0&&(e.sendQueue(),e.waitingToTransmitQueue=!1)})},t.exports=r},function(t){"use strict";t.exports=function(){return function(){}}},function(t){t.exports.envVars={dataCollectorUrl:"http://127.0.0.1:8002/api/v1/track",userServiceUrl:"http://stage-identity.spid.se/api/v1/identify",errorReportingUrl:"",sdkVersion:"0.1.0"}},function(t,e,i){"use strict";function r(t){if(!t)throw new Error("activity required");this.activity=t,this.pageId=t.pageId,this.pageType=t.pageType}var o=i(8);r.prototype.trackPageLoad=function(t,e){var i=this.activity.createScaffold(!0);return i["@type"]=e||"Read",i.object=this.addPageStandards(),i.object.displayName=t||document.title,new o(this.activity,i,["object"])},r.prototype.trackForm=function(t,e,i){var r=this.activity.createScaffold();return r["@type"]=i||"Post",r.object=this.addPageStandards(),r.result={"@type":e,"@id":this.pageId+":form:"+t},new o(this.activity,r,["object","result"])},r.prototype.trackComment=function(t,e){return this.trackForm(t,"Note",e)},r.prototype.trackPoll=function(t,e){return this.trackForm(t,"Question",e)},r.prototype.trackClick=function(t,e,i,r,n){var s=this.activity.createScaffold();return s["@type"]=n||"Accept",s.object={"@id":this.pageId+":element:"+t,"@type":"Link",displayName:e},s.target={"@id":r,"@type":i},new o(this.activity,s,["object","target"])},r.prototype.trackSocial=function(t,e,i){var r=this.activity.createScaffold();return r["@type"]=i||"Like",r.object=this.addPageStandards(),r.origin={"@id":this.pageId+":element:"+t,"@type":"Link"},r.target={"@id":"urn:"+e.toLowerCase()+":"+r["@type"].toLowerCase(),"@type":"Service"},new o(this.activity,r,["object","origin","target"])},r.prototype.trackMediaState=function(t,e,i){var r=this.activity.createScaffold();return r["@type"]=i||"Watch",r.object={"@type":e,"@id":t},r.origin=this.addPageStandards(),new o(this.activity,r,["object","origin"])},r.prototype.trackScroll=function(t,e){var i=this.activity.createScaffold();return i["@type"]=e||"Arrive",i.object=this.addPageStandards(),i.result={"@type":"Place","@id":this.pageId+":scroll:"+t,"spt:depth":t},new o(this.activity,i,["object","result"])},r.prototype.trackVisibility=function(t,e,i){var r=this.activity.createScaffold();return r["@type"]=i||"View",r.origin=this.addPageStandards(),r.object={"@type":"Content","@id":this.pageId+":element:"+t},e.start?r.object.startTime=e.start:e&&!e.end&&(r.object.startTime=e),e.end&&(r.object.endTime=e.end),new o(this.activity,r,["origin","object"])},r.prototype.trackExit=function(t,e,i){var r=this.activity.createScaffold();return r["@type"]=i||"Leave",r.object=this.addPageStandards(),void 0!==typeof t&&void 0!==typeof e&&(r.target={"@type":e,"@id":t}),new o(this.activity,r,["object","target"])},r.prototype.trackEngagementTime=function(t,e){var i=this.activity.createScaffold();return i["@type"]=e||"View",i.object=this.addPageStandards(),i.duration=t,new o(this.activity,i,["object"])},r.prototype.trackCustomEvent=function(t,e){var i=this.activity.createScaffold(),r=[];if(!e||!t)throw new Error("activityType and obj is required");i["@type"]=e;for(var n in t)i[n]=t[n],r.push(n);return new o(this.activity,i,r)},r.prototype.addPageStandards=function(){var t={};return t["@type"]=this.activity.pageType,t["@id"]=this.activity.pageId,t.url=document.URL,t.displayName=document.title,t},t.exports=r},function(t,e,i){"use strict";var r={};try{r=i(7)}catch(o){r=i(2)}var n=i(6);t.exports.retry=function(t,e,i){if(!t||"number"!=typeof t)throw new Error("times required");if(!e||"function"!=typeof e)throw new Error("task required");if(!i||"function"!=typeof i)throw new Error("callback required");var r=1,o=function(){arguments[0]&&r>=t?i.apply(null,arguments):arguments[0]?(r+=1,e(o)):i.apply(null,arguments)};e(o)},t.exports.getViewportDimensions=function(){var t,e;return"undefined"!=typeof window.innerWidth?(t=window.innerWidth,e=window.innerHeight):"undefined"!=typeof document.documentElement.clientWidth&&0!==document.documentElement.clientWidth?(t=document.documentElement.clientWidth,e=document.documentElement.clientHeight):(t=document.getElementsByTagName("body")[0].clientWidth,e=document.getElementsByTagName("body")[0].clientHeight),t+"x"+e},t.exports.getDeviceLanguage=function(){var t;return navigator.userLanguage?t=navigator.userLanguage:navigator.language&&(t=navigator.language),t},t.exports.getTimestamp=function(){var t=new Date,e=-t.getTimezoneOffset(),i=e>=0?"+":"-",r=function(t){var e=Math.abs(Math.floor(t));return(10>e?"0":"")+e},o=t.getFullYear()+"-"+r(t.getMonth()+1)+"-"+r(t.getDate());return o=o+"T"+r(t.getHours())+":"+r(t.getMinutes()),o=o+":"+r(t.getSeconds()),o=o+i+r(e/60)+":"+r(e%60)},t.exports.getUuidV4=function(){for(var t="",e=0;36>e;e++){var i=null;i=14===e?4:19===e?Math.floor(4*Math.random()+8).toString(16):8===e||13===e||18===e||23===e?"-":Math.floor(16*Math.random()).toString(16),t+=i}return t},t.exports.sendErrorReport=function(t){var e={errorCode:"GENERAL_ACTIVITY_ERROR",errorMessage:"Something went wrong",sdkType:"JS",sdkVersion:r.envVars.sdkVersion,options:{clientId:"abc",dataCollectorUrl:r.envVars.dataCollectorUrl,anonymousIdentityUrl:r.envVars.userServiceUrl,errorReportingUrl:r.envVars.errorReportingUrl,retries:t}};n(r.envVars.errorReportingUrl,e)}},function(t,e,i){"use strict";function r(t){this.idObj={},this.idObj.userId=t.userId,this.idObj.sessionId=void 0,this.idObj.visitorId=t.visitorId,this.idObj.envId=void 0,this.envKey="_DataTrackerEnv",this.sessionKey="_DataTrackerSession",this.userKey="_DataTrackerUser",this.visitorKey="_DataTrackerVisitor",this.activity=t,this.idServiceUrl=this.activity.vars.envVars.userServiceUrl,this.opts=t.opts,this.transport=this.activity.transport?this.activity.transport:o}var o=i(6);r.prototype.getUserId=function(t){if(void 0!==this.idObj.visitorId)return t(null,this.visitorId);var e={sessionId:this.getUserIdFromCookie(this.sessionKey),environmentId:this.getUserIdFromCookie(this.envKey),userId:this.getUserIdFromCookie(this.userKey)},i=this.getUserIdFromCookie(this.visitorKey);null!==i&&"undefined"!==i&&void 0!==typeof i&&(e.visitorId=i),console.log("cookie ID"),console.log(e);var r=this;this.getUserIdFromService(e,function(e,i){if(e)return t(e);r.idObj.userId=i.userId,r.idObj.sessionId=i.sessionId,r.idObj.visitorId=i.visitorId,r.idObj.envId=i.environmentId;var o=!1;i.environmentIdTemporary===!0&&(o=!0),r.setUserIdInCookie(o),t(null,r.idObj)})},r.prototype.getUserIdFromCookie=function(t){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||void 0},r.prototype.getUserIdFromService=function(t,e){this.transport(this.activity.vars.envVars.userServiceUrl,t,function(t,i){if(t)return e(t);var r=JSON.parse(i.response);e(null,r.data)})},r.prototype.setUserIdInCookie=function(t){var e=new Date,i=e.getTime(),r=i+36e9;e.setTime(r),document.cookie=t?this.envKey+"="+this.idObj.envId:this.envKey+"="+this.idObj.envId+";expires="+e.toGMTString(),document.cookie=this.sessionKey+"="+this.idObj.sessionId,document.cookie=this.visitorKey+"="+this.idObj.visitorId+";expires="+e.toGMTString(),document.cookie=this.userKey+"="+this.idObj.userId+";expires="+e.toGMTString()},t.exports=r},function(t,e,i){"use strict";function r(){if(XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.6.0")}catch(t){try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(t){throw new Error("This browser does not support AJAX")}}}function o(t,e,i){if(!i)throw new Error("callback required");return t?e&&"object"==typeof e?void n.retry(5,function(i){var o=r();o.onreadystatechange=function(){4===this.readyState&&(200===this.status?i(null,o):i("Failed with status "+this.status))},o.open("POST",t),o.setRequestHeader("Content-Type","application/json; charset=utf-8"),o.setRequestHeader("X-Requested-With","XMLHttpRequest");try{var n=JSON.stringify(e);o.send(n)}catch(s){i(s.name+": "+s.message)}},i):i("data required"):i("url required")}var n=i(4);t.exports=o},function(t){t.exports.envVars={dataCollectorUrl:"http://pulse.spid.se/api/v1/track",userServiceUrl:"http://stage-identity.spid.se/api/v1/identify",errorReportingUrl:"",sdkVersion:"0.1.0"}},function(t){"use strict";function e(t,e,i){if(!t)throw new Error("activity required");if(!e)throw new Error("data required");this.activity=t,this.data=e,this.objectOrder=i||[]}e.prototype.queue=function(){this.activity.addToQueue(this.data)},e.prototype.send=function(t){this.activity.send(this.data,t)},e.prototype.addProperty=function(t,e,i){var r=this.getObjectKey(t);return this.data[r][e]=i,this},e.prototype.addCustomData=function(t,e){var i=this.getObjectKey(t);return this.data[i]["spt:custom"]=e,this},e.prototype.getObjectKey=function(t){if("primary"===t)return this.objectOrder[0];if("secondary"===t)return this.objectOrder[1];if("tertiary"===t)return this.objectOrder[2];throw new Error("Object reference not valid")},t.exports=e}])});